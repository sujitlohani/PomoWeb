{% extends "base.html" %}

{% block content %}
  <div class="container mx-auto max-w-4xl px-6 py-6">
    <h2 class="text-3xl font-semibold text-center text-gray-800 mb-6">Admin Dashboard</h2>

    <!-- Task Assignment Section -->
    <div class="bg-white p-6 rounded-lg shadow-lg">
      <h3 class="text-xl font-medium text-gray-700 mb-4">Assign a Task</h3>
      <form method="POST" class="space-y-4">
        <div>
          <label for="user_id" class="block text-gray-600">Assign to User</label>
          <select name="user_id" id="user_id" class="w-full p-3 border border-gray-300 rounded-md">
            {% for user in users %}
              <option value="{{ user.id }}">{{ user.username }}</option>
            {% endfor %}
          </select>
        </div>

        <div>
          <label for="task_description" class="block text-gray-600">Task Description</label>
          <input type="text" name="task_description" id="task_description" required
                 class="w-full p-3 border border-gray-300 rounded-md"
                 placeholder="Enter task description">
        </div>

        <div class="text-right">
          <button type="submit"
                  class="px-6 py-2 bg-blue-600 text-white font-semibold rounded-md hover:bg-blue-700 focus:outline-none">
            Assign Task
          </button>
        </div>
      </form>
    </div>

    <!-- Assigned Tasks Section -->
    <div class="bg-white p-6 mt-8 rounded-lg shadow-lg">
      <h3 class="text-xl font-medium text-gray-700 mb-4">All Assigned Tasks</h3>
      <ul class="divide-y divide-gray-200">
        {% for task in tasks %}
          <li class="py-4 flex justify-between items-start">
            <div>
              <p class="text-gray-700">
                {{ task.description }}
                — <span class="text-slate-500">Assigned to</span>
                <strong class="text-blue-600">{{ task.user.username }}</strong>
                
                {% if task.assigned_by_admin %}
                  <span class="ml-2 inline-flex items-center gap-1 text-[11px] px-2 py-0.5 rounded-full bg-amber-100 text-amber-700"
                        title="Assigned by admin">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 2l7 3v6c0 5-3.8 8.6-7 9-3.2-.4-7-4-7-9V5l7-3z"/>
                    </svg>
                    admin
                  </span>
                {% endif %}
              </p>

              <p class="text-sm mt-1">
                {% if task.completed %}
                  <span class="text-green-700 font-medium">✔ Completed</span>
                  {% if task.completed_at %}
                    <span class="ml-2 text-slate-500">
                      on {{ task.completed_at.strftime('%Y-%m-%d %H:%M') }}
                    </span>
                  {% endif %}
                {% else %}
                  <span class="text-slate-500">⏳ Pending</span>
                {% endif %}
              </p>
            </div>

            <!-- quick status badge on the right -->
            <div>
              {% if task.completed %}
                <span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-700">Done</span>
              {% else %}
                <span class="px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-700">Open</span>
              {% endif %}
            </div>
          </li>
        {% endfor %}
      </ul>
    </div>
  </div>
{% endblock %}
