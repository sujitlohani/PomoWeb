{% extends "base.html" %}
{% block title %}Home · Pomoweb{% endblock %}
{% block content %}

<div class="grid md:grid-cols-2 gap-8 items-start">
  <!-- Timer Card -->
  <section class="glass-card p-6 sm:p-8 rounded-2xl shadow-soft">
    <div class="flex items-center justify-between mb-6">
      <h1 class="text-xl font-semibold tracking-tight">Pomodoro</h1>
      <div class="inline-flex rounded-full bg-slate-100 p-1">
        <button onclick="setMode('pomodoro')" id="mode-pomodoro" class="tab">Focus</button>
        <button onclick="setMode('short')" id="mode-short" class="tab">Short</button>
        <button onclick="setMode('long')" id="mode-long" class="tab">Long</button>
      </div>
    </div>

    <div id="timer" class="text-6xl sm:text-7xl font-semibold tabular-nums text-slate-900 text-center my-6">25:00</div>

    <div class="flex items-center justify-center gap-3">
      <button id="startBtn" onclick="toggleTimer()" class="btn-primary">Start</button>
      <button onclick="resetTimer()" class="btn-outline" title="Reset">Reset</button>
    </div>
  </section>

  <!-- Tasks Card on Home -->
  <section class="glass-card p-6 sm:p-8 rounded-2xl shadow-soft">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-lg font-semibold">Quick Tasks</h2>
      <button onclick="openTaskModal()" class="btn-ghost">+ Add</button>
    </div>

    <div class="space-y-3" id="taskList">
      {% if tasks %}
        {% for task in tasks %}
          {% if not task.completed %}
            <div class="flex items-center justify-between bg-white/70 rounded-xl border border-slate-200 p-3" id="task-{{ task.id }}">
              <div class="flex items-center gap-3">
                <form id="toggle-task-{{ task.id }}" class="task-form" data-task-id="{{ task.id }}">
                  <button type="button" class="h-5 w-5 rounded-full border border-slate-300 flex items-center justify-center" onclick="toggleTask({{ task.id }})">
                    {% if task.completed %}
                      <span class="h-3 w-3 rounded-full bg-accent-500 inline-block"></span>
                    {% endif %}
                  </button>
                </form>

                <span class="task-desc {% if task.completed %}line-through text-slate-400{% endif %}">{{ task.description }}</span>
                  {% if task.assigned_by_admin %}
                    <span class="ml-2 inline-flex items-center gap-1 text-[11px] px-2 py-0.5 rounded-full bg-amber-100 text-amber-700"
                          title="Assigned by admin">
                      <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2l7 3v6c0 5-3.8 8.6-7 9-3.2-.4-7-4-7-9V5l7-3z"/>
                      </svg>
                      admin
                    </span>
                  {% endif %}

              </div>

              <form id="delete-task-{{ task.id }}" class="task-form" data-task-id="{{ task.id }}">
                <button type="button" onclick="deleteTask({{ task.id }})" class="text-slate-500 hover:text-red-600" title="Delete">Delete</button>
              </form>
            </div>
          {% endif %}
        {% endfor %}
      {% else %}
        <p class="text-slate-500">No tasks yet. Add your first focus item.</p>
      {% endif %}
    </div>

    <div class="mt-5 text-right">
      <a href="{{ url_for('tasks') }}" class="text-sm text-slate-600 hover:text-slate-900 underline-offset-4 hover:underline">Open full task list →</a>
    </div>
  </section>

  <!-- Completed Tasks Card -->
  <section class="glass-card p-6 sm:p-8 rounded-2xl shadow-soft">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-lg font-semibold">Completed Tasks</h2>
    </div>

    <div class="space-y-3" id="completedTaskList">
      {% if tasks %}
        {% for task in tasks %}
          {% if task.completed %}
            <div class="flex items-center justify-between bg-white/70 rounded-xl border border-slate-200 p-3" id="task-{{ task.id }}">
              <div class="flex items-center gap-3">
                <span class="line-through text-slate-400">{{ task.description }}</span>
              </div>
            </div>
          {% endif %}
        {% endfor %}
      {% else %}
        <p class="text-slate-500">No completed tasks yet.</p>
      {% endif %}
    </div>
  </section>
</div>

<!-- Add Task Modal -->
<div id="taskModal" class="fixed inset-0 z-40 hidden">
  <div class="absolute inset-0 bg-slate-900/30 backdrop-blur-sm" onclick="closeTaskModal()"></div>
  <div class="relative z-10 max-w-md mx-auto mt-28 glass-card rounded-2xl shadow-soft p-6">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-lg font-semibold">Add a New Task</h3>
      <button onclick="closeTaskModal()" class="text-slate-500 hover:text-slate-700">Close</button>
    </div>
    <form id="addTaskForm" class="space-y-4">
      <input id="taskDescription" name="description" type="text" placeholder="What will you focus on?" class="input" required>
      <div class="flex justify-end gap-3">
        <button type="button" onclick="closeTaskModal()" class="btn-outline">Cancel</button>
        <button type="submit" class="btn-primary">Save Task</button>
      </div>
    </form>
  </div>
</div>

<!-- Toggle Task Confirmation Popup -->
<div id="toggleTaskPopup" class="fixed inset-0 z-40 hidden">
  <div class="absolute inset-0 bg-slate-900/30 backdrop-blur-sm" onclick="closeTaskModal()"></div>
  <div class="relative z-10 max-w-md mx-auto mt-28 glass-card rounded-2xl shadow-soft p-6">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-lg font-semibold">Are you finished with this task?</h3>
    </div>
    <div class="flex justify-end gap-3">
      <button id="cancelToggleButton" type="button" class="btn-outline">No, Keep Working</button>
      <button id="confirmToggleButton" type="button" class="btn-primary">Yes, Mark as Done</button>
    </div>
  </div>
</div>

<!-- Delete Task Confirmation Popup -->
<div id="deleteTaskPopup" class="fixed inset-0 z-40 hidden">
  <div class="absolute inset-0 bg-slate-900/30 backdrop-blur-sm" onclick="closeTaskModal()"></div>
  <div class="relative z-10 max-w-md mx-auto mt-28 glass-card rounded-2xl shadow-soft p-6">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-lg font-semibold">Are you sure you want to delete this task?</h3>
    </div>
    <div class="flex justify-end gap-3">
      <button id="cancelDeleteButton" type="button" class="btn-outline">Cancel</button>
      <button id="confirmDeleteButton" type="button" class="btn-primary">Yes, Delete</button>
    </div>
  </div>
</div>

<script src="{{ url_for('static', filename='js/timer.js') }}"></script>

{% endblock %}
